# ğŸŒ Ngnix 

> Nginx æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„WebæœåŠ¡å’Œåå‘ä»£ç†æœåŠ¡ï¼Œå®ƒçš„ç‰¹æ€§æ˜¯é«˜å¹¶å‘ã€å†…å­˜å ç”¨å°‘ã€é…ç½®ç®€å•ç­‰ç­‰ã€‚

## å®‰è£…

``` bash
yum install nginx
```

## å¸¸ç”¨å‘½ä»¤

``` bash title="å¯åŠ¨"
systemctl start nginx
#nginx
```

``` bash title="åœæ­¢"
systemctl stop nginx
#nginx -s stop
```

``` bash title="é‡å¯"
systemctl restart nginx
```

``` bash title="é‡è½½"
systemctl reload nginx
#nginx -s reload
```

``` bash title="æµ‹è¯•é…ç½®"
nginx -t
nginx -T
# å¤§ T ä¼šåˆ—å‡ºæ‰€æœ‰é…ç½®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ include çš„é…ç½®æ–‡ä»¶
```

``` bash title="æŸ¥çœ‹çŠ¶æ€"
systemctl status nginx
```

``` bash title="æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€"
ps aux|grep nginx
```

``` bash title="æŸ¥çœ‹ç‰ˆæœ¬"
nginx -v
nginx -V
# å¤§ V ä¼šåˆ—å‡ºæ‰€æœ‰é…ç½®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç¼–è¯‘å‚æ•°
```

``` bash title="æŸ¥çœ‹å¸®åŠ©"
nginx -h
```

``` bash title="æŸ¥çœ‹æ—¥å¿—"
tail -f /var/log/nginx/error.log
tail -f /var/log/nginx/access.log
```

## é…ç½®

### æ­å»ºç½‘ç«™

- é…ç½®ç½‘ç«™

``` nginx title="/etc/nginx/conf.d/ssl.byteszero.cn.conf"
server {
    # BytesZero åšå®¢ç½‘ç«™
    location / {
        root /root/pro/blog/site/;
        index index.html;
    }
}
```

- è§£å†³ 403 é—®é¢˜

``` bash title="etc/nginx/nginx.conf"
# æŸ¥çœ‹ worker è¿›ç¨‹ç”¨æˆ·
ps aux|grep nginx
# ä¿®æ”¹ nginx.conf ä¸­çš„ user
user root;
# ä¿®æ”¹ç½‘ç«™ç›®å½•æƒé™
chown -R root:root /root/pro/blog/site/
# é‡å¯æœåŠ¡
systemctl restart nginx
# ã€â—ï¸ã€‘éªŒè¯ä¸€ä¸‹ worker è¿›ç¨‹ç”¨æˆ·
ps aux|grep nginx
```


### é…ç½®è¯ä¹¦

- ç½‘ç«™è¯ä¹¦é…ç½®

``` nginx title="/etc/nginx/conf.d/ssl.byteszero.cn.conf"
server {
    ## å¿…é€‰SSLé…ç½®
    listen 443 ssl; # å¼€å¯443ç«¯å£ç›‘å¬
    server_name ssl.byteszero.cn; # è¢«ç›‘å¬çš„åŸŸå
    ssl_certificate /etc/nginx/cert/ssl.byteszero.cn.pem; # è¯ä¹¦æ–‡ä»¶è·¯å¾„
    ssl_certificate_key /etc/nginx/cert/ssl.byteszero.cn.key; # ç§é’¥æ–‡ä»¶è·¯å¾„
}
```
- http è‡ªåŠ¨é‡å®šå‘åˆ° https

``` nginx title="/etc/nginx/nginx.conf"
server {
    listen       80;
    listen       [::]:80;
    # HTTPåˆ°HTTPSçš„é‡å®šå‘
    return 301 https://$host$request_uri;
}
```

### åå‘ä»£ç†

``` nginx title="/etc/nginx/conf.d/ssl.byteszero.cn.conf"
# api æ¥å£ä»£ç†
server {
    location /api/ {
        # ä¸ºäº†å»æ‰ /api å‰ç¼€
        rewrite ^/api(/.*)$ $1 break; 
        # ä»£ç†åˆ°æœ¬åœ° 8081 ç«¯å£æœåŠ¡ä¸Š
        proxy_pass http://localhost:8081;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

### è´Ÿè½½å‡è¡¡

``` nginx title="/etc/nginx/conf.d/ssl.byteszero.cn.conf"
upstream backend_servers {
    server backend_server1 weight=3;
    server backend_server2 weight=2;
    server backend_server3;
    # æ·»åŠ æ›´å¤šçš„åç«¯æœåŠ¡å™¨å¹¶è®¾ç½®æƒé‡
}

server {
    location / {
        proxy_pass http://backend_servers;
    }
}
```

### å…¶ä»–é…ç½®

- é…ç½® Worker æ•°é‡

``` nginx title="/etc/nginx/nginx.conf"
worker_processes 4;
# ä¸€èˆ¬è®¾ç½® CPU æ ¸æ•°çš„ 1ï½4 å€
```

- é…ç½® Worker è¿æ¥æ•°

``` nginx title="/etc/nginx/nginx.conf"
events {
    worker_connections 1024;
}
# ä¸€èˆ¬è®¾ç½®ä¸º 1024ï¼Œå¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹æ¯ä¸ª CPU æ ¸å¿ƒèƒ½å¤„ç†çš„æœ€å¤§è¿æ¥æ•°ï¼Œè®¾å®šå³å¯
cat /proc/sys/net/core/somaxconn
```

- æŸ¥çœ‹æœåŠ¡çŠ¶æ€

``` bash
systemctl status nginx
```

``` bash
â— nginx.service - The nginx HTTP and reverse proxy server
   Loaded: loaded (/usr/lib/systemd/system/nginx.service; enabled; vendor preset: enabled)
   Active: active (running) since Sun 2023-12-17 16:00:22 CST; 16min ago
  Process: 964949 ExecReload=/bin/kill -s HUP $MAINPID (code=exited, status=0/SUCCESS)
  Process: 965138 ExecStart=/usr/sbin/nginx (code=exited, status=0/SUCCESS)
  Process: 965136 ExecStartPre=/usr/sbin/nginx -t (code=exited, status=0/SUCCESS)
  Process: 965134 ExecStartPre=/usr/bin/rm -f /run/nginx.pid (code=exited, status=0/SUCCESS)
 Main PID: 965139 (nginx)
    Tasks: 5 (limit: 11849)
   Memory: 3.1M
   CGroup: /system.slice/nginx.service
           â”œâ”€965139 nginx: master process /usr/sbin/nginx
           â”œâ”€965140 nginx: worker process
           â”œâ”€965141 nginx: worker process
           â”œâ”€965142 nginx: worker process
           â””â”€965143 nginx: worker process
```
:::tip å¦‚ä¸Šå¯ä»¥çœ‹å‡º

- æœåŠ¡å·²ç»å¯åŠ¨
- è¿è¡Œäº† 16 åˆ†é’Ÿ
- ä¸»è¿›ç¨‹ ID ä¸º 965139
- å·¥ä½œè¿›ç¨‹æ•°ä¸º 5
- å†…å­˜å ç”¨ 3.1M
- 1 master è¿›ç¨‹
- 4 ä¸ª worker è¿›ç¨‹

:::

